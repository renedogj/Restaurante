<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Inicio de sesion</title>
		<link rel="stylesheet" type="text/css" href="css/contenedora.css">
		<link rel="stylesheet" type="text/css" href="css/iniciosesion.css">

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

		<script src="https://www.gstatic.com/firebasejs/ui/4.8.0/firebase-ui-auth.js"></script>
		<link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.0/firebase-ui-auth.css" />
	</head>
	<body onresize="ajustarTamaño()">
		<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-analytics.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-database.js"></script>

		<script>
			var firebaseConfig = {
				apiKey: "AIzaSyDuU1dXAPfANThrSK316lY9nPIDZvN8T68",
				authDomain: "restaurante-358d8.firebaseapp.com",
				databaseURL: "https://restaurante-358d8-default-rtdb.firebaseio.com",
				projectId: "restaurante-358d8",
				storageBucket: "restaurante-358d8.appspot.com",
				messagingSenderId: "966943328871",
				appId: "1:966943328871:web:5aff94344e5db285a862c2",
				measurementId: "G-D21XTDESW6"
			};
			// Initialize Firebase
			firebase.initializeApp(firebaseConfig);
			firebase.analytics();
			cerrarSesion()

			firebase.auth().onAuthStateChanged(function (user) {
				if (user) {
					var displayName = user.displayName;
					var email = user.email;
					var emailVerified = user.emailVerified;
					var photoURL = user.photoURL;
					var isAnonymous = user.isAnonymous;
					var uid = user.uid;
					var providerData = user.providerData;
				} else {

				}
			});

			function cerrarSesion() {
				firebase.auth().signOut();
			}

			function acceder() {
				cerrarSesion()
				var email = document.getElementById('correo').value;
				var password = document.getElementById('password').value;

				firebase.auth().signInWithEmailAndPassword(email, password)
					.then((userCredential) => {
						comprobarUsuario(userCredential.user.uid)
					})
					.catch(function (error) {
						console.log(error)
						document.getElementById('password').value = null;
						$("#p-fallo-inicio").text("Usuario o Contraseña incorrecto");                       
					});
			}

			function comprobarUsuario(userUid){
				const refUsuario = firebase.database().ref('Users/' + userCredential.user.uid);
				refUsuario.on('value', (snapshot) => {
					if(snapshot.exists()){
						window.location.assign("index.html");
					}
				}, function(error) {
					$("#p-fallo-inicio").text("No tienes permisos de administrador"); 
					document.getElementById('correo').value = null;
					document.getElementById('password').value = null;
				});
			}
		</script>
		<div class="contenedora">
			<div class="iniciosesion">
				<div class="form-inicio-sesion">
					<h1>Iniciar Sesion</h1>
					<div class="div-contenedora-labelinput">
						<label for="correo">Correo electronico:</label>
						<input id="correo" type="email" size="50" maxlength="25" placeholder=" Correo electronico" />
					</div>
					<div class="div-contenedora-labelinput">
						<label for="password">Contraseña:</label>
						<div class="div-inputPassword">
							<input id="password" type="password" size="50" maxlength="25" placeholder=" Contraseña" />
							<i class="far fa-eye" id="togglePassword"></i>
						</div>
					</div>
					<div class="div-fallo-inicio">
						<p id="p-fallo-inicio"></p>
					</div>
					<button onclick="acceder()" class="boton-iniciarsesion" id="boton" type="submit">Iniciar Sesión</button>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			ajustarTamaño();
			function ajustarTamaño() {
				inicioSesionInnerHeight = $(".iniciosesion").innerHeight();
				marginTop = ($(window).height() - inicioSesionInnerHeight) / 2;
				$(".iniciosesion").css("margin", marginTop + "px auto");
			}

			const togglePassword = document.querySelector('#togglePassword');
			const inputpassword = document.querySelector('#password');

			togglePassword.addEventListener('click', function (e) {
				const type = inputpassword.getAttribute('type') === 'password' ? 'text' : 'password';
				inputpassword.setAttribute('type', type);
				this.classList.toggle('fa-eye-slash');
			});

			inputpassword.addEventListener("keyup", function (event) {
				if (event.keyCode === 13) {
					event.preventDefault();
					$("#boton").click();
				} else {
					$("#p-fallo-inicio").text("");
				}
				if (event.getModifierState("CapsLock")) {
					$("#p-fallo-inicio").text("Bloq Mayús activado!");
				} else {
					$("#p-fallo-inicio").text("");
				}
			});
		</script>
	</body>
</html>